group 'ru.maratk'
version '1.0-SNAPSHOT'

apply plugin: 'war'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    providedCompile 'javax:javaee-web-api:7.0'
    providedCompile 'fish.payara.blue.extras:payara-micro:4.1.1.171.1'
    testCompile group: 'junit', name: 'junit', version: '4.11'
}


war.baseName = 'rest-payara-uberjar'

task uberJar(type: Exec, dependsOn: war) {
    def payaraJarPath = configurations
            .providedCompile
            .find {it.name =~ /payara-micro.*\.jar/}
            .absolutePath

    def warFile = war.archivePath
    def uberJarPath = warFile.path.replaceAll(/\.war$/, '.jar')

    commandLine('java', '-jar', payaraJarPath, '--deploy', warFile, '--outputUberJar', uberJarPath)
}